<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Simple Code Editor</title>
    <style type="text/css" media="screen">
        body {
            overflow: hidden;
        }
        
        header {
            padding-top: 2px;
        }
        
        input[type="button"], select {
            width: 120px;
            margin-left: 35px;
            display: block;
            float: left;
        }
        
        #editor {
            margin: 0;
            position: absolute;
            top: 40px;
            bottom: 0;
            left: 0;
            right: 0;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/ace/1.1.9/min/ace.js" type="text/javascript" charset="utf-8"></script>



</head>

<body>
    <header id="header">
        <select id="codeLanguage" name="codeLanguage">
            <option value="html">HTML</option>
            <option value="javascript">JavaScript</option>
            <option value="sql" selected="selected">SQL</option>
            <option value="vbscript">VBScript</option>
        </select>
        <input type="button" id="loadFile" name="loadFile" value="Load File" />
        <input type="file" id="fileToLoad" name="file" style="display:none;" />
        <input type="button" name="save" id="save" value="Save File" />
    </header>
    <br />
    <pre id="editor">

</pre>

    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/twilight");
        editor.setHighlightActiveLine(true);
        editor.$blockScrolling = Infinity
        editor.getSession().setMode("ace/mode/sql");
        editor.session.setNewLineMode('windows');



        $('document').ready(function() {

            $("#codeLanguage").change(function() {
                var langCode = $('#codeLanguage :selected').val();
console.log(langCode);

                editor.getSession().setMode("ace/mode/" + langCode);
            });

            $("#loadFile").click(function() {
                $('#fileToLoad').click();
            });


            $('#fileToLoad').change(function() {
                loadTextFile($(this)[0].files[0]);
            });


            $("#save").click(function() {
                var saveFileName = prompt("Enter the desired filename", "Download.sql")
                saveTextFile(saveFileName);
            });

        });



        function loadTextFile(file) {

            var reader = new FileReader();
            $(reader).load(function() {
                editor.setValue(reader.result, -1);
            });

            reader.readAsText(file);
        }


        function saveTextFile(filename) {

            var content = editor.getSession().getValue();

            var dl = document.createElement('a');
            dl.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            dl.setAttribute('download', filename);

            // Set hidden so the element doesn't disrupt your page
            dl.setAttribute('visibility', 'hidden');
            dl.setAttribute('display', 'none');
            // Append to page
            document.body.appendChild(dl);
            // Now you can trigger the click
            dl.click();

        }
    </script>

</body>

</html>
